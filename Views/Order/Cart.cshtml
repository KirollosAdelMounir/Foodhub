@model IEnumerable<FoodHub.Models.Order>

@{
    float TotalPrice = 0f;
}

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.foodItem.FoodItemName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.foodItem.Price)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Quantity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.OrderDate)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody id="tablebody">
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.foodItem.FoodItemName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.foodItem.Price)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Quantity)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.OrderDate)
                </td>
                <td>
                    <button type="submet" class="btn btn-primary" onclick="additem(@item.foodItemId);">Add</button>
                    <button type="submet" class="btn btn-danger" onclick="removeitem(@item.foodItemId);">Remove</button>
                </td>
            </tr>
            TotalPrice += (item.foodItem.Price * item.Quantity);
        }
    </tbody>
</table>

<div id="payment">
    <h2>Total Price :</h2>
    <h3 class="text-info">@TotalPrice$</h3>
    <a class="btn btn-success">Order</a>
</div>

@section Scripts{
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript">
        var ToatalPrice = 0;
        function additem(itemId) {
            $('#tablebody tr').remove();
            ToatalPrice=0;
            
            var formData = new FormData();
            formData.append("id", itemId);
            $.ajax({
                type: "POST",
                url: '@Url.Action("AddItem")',
                contentType: false,
                processData: false,
                cache: false,
                data: formData,
                dataType: "json",
                success: function (data) {
                    //console.log(data);
                    if(data != null){
                        $.each(data,function (key,value){
                            $('#tablebody').append(
                            "<tr>" + 
                                "<td>" + value.foodItem.foodItemName + "</td>" +
                                "<td>" + value.foodItem.price + "</td>" +
                                "<td>" + value.quantity + "</td>" +
                                "<td>" + value.orderDate + "</td>" +
                                '<td><button type="submet" class="btn btn-primary" onclick="additem(' + value.foodItemId + ');">Add</button>' +
                                '<button type="submet" class="btn btn-danger" onclick="removeitem(' + value.foodItemId + ');">Remove</button></td>' +
                            "</tr>");
                            ToatalPrice += value.foodItem.price * value.quantity;
                        });
                        $('#payment h3').html(ToatalPrice + "$");
                    }

                },
                error: function (req, status, error) {
                    console.log(error);
                }
            });
        }
        function removeitem(itemId) {
            $('#tablebody tr').remove();
            ToatalPrice = 0;

            var formData = new FormData();
            formData.append("id", itemId);
            $.ajax({
                type: "POST",
                url: '@Url.Action("RemoveItem")',
                contentType: false,
                processData: false,
                cache: false,
                data: formData,
                dataType: "json",
                success: function (data) {
                    //console.log(data);
                    if (data != null) {
                        $.each(data, function (key, value) {
                            $('#tablebody').append(
                                "<tr>" +
                                "<td>" + value.foodItem.foodItemName + "</td>" +
                                "<td>" + value.foodItem.price + "</td>" +
                                "<td>" + value.quantity + "</td>" +
                                "<td>" + value.orderDate + "</td>" +
                                '<td><button type="submet" class="btn btn-primary" onclick="additem(' + value.foodItemId + ');">Add</button>' +
                                '<button type="submet" class="btn btn-danger" onclick="removeitem(' + value.foodItemId + ');">Remove</button></td>' +
                                "</tr>");
                            ToatalPrice += value.foodItem.price * value.quantity;
                        });
                        $('#payment h3').html(ToatalPrice +"$");
                    }

                },
                error: function (req, status, error) {
                    console.log(error);
                }
            });
        }

    </script>
}


